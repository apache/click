<!DOCTYPE' HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
 "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
 <meta name="Author" content="Malcolm Edgar"/>
 <link rel="stylesheet" type="text/css" href="../help.css"/>
</head>
<body>
  
<h1>Best Practices</h1>

This section discusses Best Practices for designing and building Click application.
The following topics are covered:
<ul>
  <li><a href="#security">Security</a> - use J2EE role based security
  </li>
  <li><a href="#automapping">Page Auto Mapping</a> - use Convention over Configuration
  </li>
  <li><a href="#navigation">Navigation</a> - use Page classes to forward and redirect
  </li>
  <li><a href="#templating">Templating</a> - to standardize your web application
  </li>
  <li><a href="#menus">Menus</a> - centralize your page navigation
  </li>
  <li><a href="#logging">Logging</a> - use Log4j in a base page
  </li>
  <li><a href="#error-handling">Error Handling</a> - use custom error page
  </li>
</ul>

<p>&nbsp;</p>

<a name="security" class="heading"><h2>Security</h2></a>

For application security it is highly recommended that you use the J2EE Servlet 
path role based security model. While Click pages provide an 
<tt>onSecurityCheck()</tt> method for rolling your own security model, 
the J2EE model provides numerous advantages.
<p/>
These advantages include:

<ul>
  <li>
  Its an industry standard pattern making development and maintenance easier.
  </li>
  <li>
  Application servers generally provide numerous ways of integration with an
  organisations security infrastructure, including LDAP directories and 
  relational databases.
  </li>
  <li>  
  Servlet security model support users bookmarking pages. When users go to access
  these pages later, the container will automatically authenticate them before
  allowing them to access the resource.
  </li>
  <li>
  Using this security model you can keep your Page code free of security 
  concerns. This makes you code more reusable, or at least easier to write.
  </li>
</ul>

The J2EE Servlet security model requires users to be authenticated and
in the right roles before they can access secure resources. Relative to many of 
the J2EE specifications the Servlet security model is surprisingly simple. 
<p/>
For example to secure admin pages, you add a security 
constraint in your <tt>web.xml</tt> file. This requires users to be in the
<span class="blue">admin</span> role before they can access to any resources 
under the <span class="red">admin</span> directory:

<pre class="codeConfig">
&lt;security-constraint&gt;
   &lt;web-resource-collection&gt;
      &lt;url-pattern&gt;<span class="red">/admin/*</span>&lt;/url-pattern&gt;
   &lt;/web-resource-collection&gt;
   &lt;auth-constraint&gt;
      &lt;role-name&gt;<span class="blue">admin</span>&lt;/role-name&gt;
   &lt;/auth-constraint&gt;
&lt;/security-constraint&gt; </pre>

The application user roles are defined in the <tt>web.xml</tt> file as 
<tt>security-role</tt> elements:

<pre class="codeConfig">
&lt;security-role&gt;
   &lt;role-name&gt;<span class="blue">admin</span>&lt;/role-name&gt;
&lt;/security-role&gt;  </pre>

The Servlet security model supports three different authentication method:
<ul>
  <li>
    <tt>BASIC</tt> - only recommended for internal applications where security 
    is not important. This is the easiest authentication method, which simply
    displays a dialog box to users requiring them to authenticate before
    accessing secure resources. The BASIC method is relatively unsecure as the 
    username and password are posted to the server as a Base64 encoded string.
  </li>
  <li>
    <tt>DIGEST</tt> - recommended for internal applications with a moderate level
    of security. As with BASIC authentication, this method simply displays a 
    dialog box to users requiring them to authenticate before accessing 
    secure resources. Not all application servers support DIGEST authentication,
    with only more recent versions of Apache Tomcat supporting this method.
  </li>
  <li>
    <tt>FORM</tt> - recommended applications for where you need a customised 
    login page. For applications requiring a high level of security it is 
    recommended that you use the FORM method over Http.
  </li>
</ul>

The authentication method is specified in the &lt;login-method&gt; element. For
example to use the BASIC authentication method you would specify:

<pre class="codeConfig">
&lt;login-config&gt;
   &lt;auth-method&gt;<span class="blue">BASIC</span>&lt;/auth-method&gt;
   &lt;realm-name&gt;Admin Realm&lt;/realm-name&gt;
&lt;/login-config&gt;  </pre>

To use the FORM method you also need to specify the path to the login page and
the login error page:

<pre class="codeConfig">
&lt;login-config&gt;
   &lt;auth-method&gt;<span class="blue">FORM</span>&lt;/auth-method&gt;
   &lt;realm-name&gt;Secure Realm&lt;/realm-name&gt;
   &lt;form-login-config&gt;
      &lt;form-login-page&gt;<span class="red">/login.htm</span>&lt;/form-login-page&gt;
      &lt;form-error-page&gt;<span class="red">/login.htm?auth-error=true</span>&lt;/form-error-page&gt;
   &lt;/form-login-config&gt;
&lt;/login-config&gt; </pre>

In your Click <tt>login.htm</tt> page you need to include a special 
<span class="blue">j_security_check</span> form which includes the input
fields <span class="blue">j_username</span> and <span class="blue">j_password</span>.
For example:

<pre class="codeHtml">
<span class="kw">#if</span> ($request.getParameter(<span class="red">"auth-error"</span>))
&lt;div style="margin-bottom:1em;margin-top:1em;color:red;"&gt;
  Invalid User Name or Password, please try again.&lt;br/&gt;
  Please ensure Caps Lock is off.
&lt;/div&gt;
<span class="kw">#end</span>

&lt;form method="POST" action="<span class="blue">j_security_check</span>" name="form"&gt;
&lt;table border="0" style="margin-left:0.25em;"&gt;
 &lt;tr&gt;
   &lt;td&gt;&lt;label&gt;User Name&lt;/label&gt;&lt;font color="red"&gt;*&lt;/font&gt;&lt;/td&gt;
   &lt;td&gt;&lt;input type="text" name="<span class="blue">j_username</span>" maxlength="20" style="width:150px;"/&gt;&lt;/td&gt;
   &lt;td&gt;&nbsp;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td&gt;&lt;label&gt;User Password&lt;/label&gt;&lt;font color="red"&gt;*&lt;/font&gt;&lt;/td&gt;
   &lt;td&gt;&lt;input type="password" name="<span class="blue">j_password</span>" maxlength="20" style="width:150px;"/&gt;&lt;/td&gt;
   &lt;td&gt;&lt;input type="image" src="$context/images/login.png" title="Click to Login"/&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
&lt;/form&gt;

&lt;script type="text/javascript"&gt;
  document.form.j_username.focus(); 
&lt;/script&gt; </pre>

When using FORM based authentication do <b>NOT</b> put application logic in a 
Click Login Page class, as the role of this page is to simply render the login 
form. If you attempt to put navigation logic in your Login Page class, the 
J2EE Container may simply ignore it or throw errors.

<h4>Resources</h4>

For more information on using security see the resources below:
<ul>
  <li><a href="http://infinity.crosslogic.com/clinfinity/ContentPath/crosslogic/Resources/WebPages/cl_site/downloads/white_papers/FormBasedAuthentication.pdf">Form Based Authentication</a> by Louis E. Mauget
  </li>
  <li><a href="http://java.sun.com/products/servlet/download.html">Servlet Specification</a> by Sun Microsystems
  </li>
  <li><a href="http://en.wikipedia.org/wiki/Basic_authentication_scheme">Basic authentication scheme</a> 
  </li>
  <li><a href="http://en.wikipedia.org/wiki/Digest_access_authentication">Digest authentication scheme</a>
  </li>
  <li><a href="http://en.wikipedia.org/wiki/Https">Https URI scheme</a>
  </li>
</ul>


<a name="automapping" class="heading"><h2>Page Auto Mapping</h2></a>

<a name="navigation" class="heading"><h2>Navigation</h2></a>

<a name="templating" class="heading"><h2>Templating</h2></a>

<a name="menus" class="heading"><h2>Menus</h2></a>

<a name="logging" class="heading"><h2>Logging</h2></a>

For page logging you should use <a href="http://logging.apache.org/log4j/docs/">Log4j</a>
library. An alternative library is the 
<a href="http://jakarta.apache.org/commons/logging/">Commons Logging</a>. 
If you are using Commons Logging please be aware that there have been class loader 
issues with this library on some application servers. If you are using 
Commons Logging please make sure you have the latest version.
<p/>
The best place to define your logger is in a common base page, for example:

<pre class="codeConfig">
<span class="kw">public class</span> BasePage <span class="kw">extends</span> Page {
	
    <span class="kw">protected</span> Logger logger;
	
    <span class="kw">public</span> Logger getLogger() {
        <span class="kw">if</span> (logger == <span class="kw">null</span>) {
            logger = Logger.getLogger(getClass());
        }
        <span class="kw">return</span> logger;
    }
} </pre>

Using this pattern all your application bases should extend <tt>BasePage</tt>
so they can use the <tt>getLogger()</tt> method.

<pre class="codeConfig">
<span class="kw">public class</span> CustomerListPage <span class="kw">extends</span> BasePage {
	
    <span class="kw">public void</span> onGet() {
        <span class="kw">try</span> {
            ..
        
        } <span class="kw">catch</span> (Exception e) {
            getLogger().error(e);
        }
    }
} </pre>

If you have some very heavy debug statement you should possibly use an 
<tt>isDebugEnabled</tt> switch so it is not invoked if debug is not required.

<pre class="codeConfig">
<span class="kw">public class</span> CustomerListPage <span class="kw">extends</span> BasePage {
	
    <span class="kw">public void</span> onGet() {
        <span class="kw">if</span> (getLogger().isDebugEnabled()) {
            String msg = ..
            
            getLogger().debug(msg);
        }
        
        ..
    }
} </pre>

<p/>


Please note the Click logging facility is not designed for application use, and is 
for Click internal use only. When Click is running in <tt>production</tt> mode
it will not produce any logging output.

<a name="error-handling" class="heading"><h2>Error Handling</h2></a>



</body>
</html>
